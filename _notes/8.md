---
layout: note
title: "задание 8: комбинаторика"
---
# теория
 
## product

Функция `product` из модуля `itertools` используется для создания декартова произведения входных итерируемых объектов. Она возвращает итератор с кортежами, где каждый кортеж содержит элементы из каждого входного итерируемого объекта. 

```python
from itertools import product

result = product(A, B, C, ...)
```

Здесь `A`, `B`, `C` и т.д. - это итерируемые объекты (например, списки, кортежи, строки).


Параметр `repeat` позволяет повторить один и тот же итерируемый объект несколько раз. Это полезно, когда мы хотим создать все возможные комбинации элементов из одного множества.

```python
from itertools import product

digits = '123'
for combo in product(digits, repeat=2):
    print(''.join(combo))
```
Вывод:
```
11
12
13
21
22
23
31
32
33
```

В этом примере мы создаем все возможные двузначные комбинации из цифр 1, 2 и 3. Параметр `repeat=2` указывает, что мы хотим создать комбинации длиной 2.

Функция `product` с параметром `repeat` эквивалентна вложенным циклам. Например, `product(A, repeat=3)` эквивалентно:

```python
for x in A:
    for y in A:
        for z in A:
            yield (x, y, z)
```
## permutations

`permutations` генерирует все возможные перестановки элементов из заданного итерируемого объекта.

```python
from itertools import permutations

result = permutations(iterable, r=None)
```

- `iterable`: входной итерируемый объект
- `r`: длина каждой перестановки (необязательный параметр)
  
Если `r` не указан, генерируются все возможные перестановки полной длины.

```python
from itertools import permutations

for p in permutations('ABC', 2):
    print(''.join(p))
```

Вывод:
```
AB
AC
BA
BC
CA
CB
```

`permutations` полезна, когда нужно получить все возможные упорядоченные комбинации элементов, где порядок важен.

## перестановки

Перестановки - это способы упорядочения n различных элементов. Количество перестановок из n элементов обозначается $P(n)$ и вычисляется по формуле:

$$P(n) = n!$$

где $n!$ - факториал числа $n$.

Пример: Сколько способов расставить 5 книг на полке?
$$P(5) = 5! = 5 \cdot 4 \cdot 3 \cdot 2 \cdot 1 = 120$$

## размещения

Размещения - это упорядоченные наборы из k элементов, выбранных из n различных элементов. Количество размещений из n по k обозначается A(n,k) и вычисляется по формуле:

$$A(n,k) = \frac{n!}{(n-k)!}$$

Пример: Сколько способов выбрать и расставить по местам 3 призера из 10 участников соревнования?
$$A(10,3) = \frac{10!}{(10-3)!} = \frac{10!}{7!} = 720$$

## сочетания

Сочетания - это неупорядоченные наборы из $k$ элементов, выбранных из $n$ различных элементов. Количество сочетаний из $n$ по $k$ обозначается $C(n,k)$ и вычисляется по формуле:

$$C(n,k) = \frac{n!}{k!(n-k)!}$$

Пример: Сколько способов выбрать команду из 3 человек из группы из 10 человек?
$$C(10,3) = \frac{10!}{3! \cdot 7!} = 120$$

Важно помнить:
1. В перестановках и размещениях порядок важен, в сочетаниях - нет.
2. Размещения можно рассматривать как обобщение перестановок, где $k \leqslant n$.
3. Сочетания связаны с размещениями: $C(n,k) = \frac{A(n,k)} {k!}$


# задачи

# подсчёт комбинаций

## простой подсчёт комбинаций, правило произведения
[условие](https://education.yandex.ru/ege/task/873812cd-4e5f-4edd-9c3a-687fb5af8908)

12 девочек $\times$ 5 мальчиков = 60 танцевальных пар (**правило произведения** – если объект $a$ из множества $A$ можно выбрать $n$ способами, а объект $b$ из множества $B$ – $m$ способами, то выбрать $a$ И $b$ можно $n \times m$ способами)


## подсчёт перестановок

[условие](https://education.yandex.ru/ege/task/45fd2b37-8ef4-40a0-8dc5-5dfea52424b1)

На первую позицию – 7 букв, на вторую – 6, и т.д. Итоговый результат делим на 2, т.к. порядок букв И для нас не важен. Ответ: $\frac{7!}{2} = 2520$

## подсчёт n-ричных чисел с условием

[условие](https://education.yandex.ru/ege/task/1623f1e7-f1c5-4c53-8122-3a5ad8752cb2)

1. Позицию для 7 можно выбрать 5 способами
2. Позиции для цифр с числовым значением $>8$ можно выбрать $C(4, 3)$ способами, на каждой из этих позиций может стоять $9, A, B$ -> всего $3^3 \times C(4, 3)$ вариантов
3. Позиции для остальных цифр определены, на них могут стоять цифры 0, 1, 2, 3, 4, 5, 6, 8 (8 вариантов).
4. Шаги 2-3 повторяем для случаев, когда цифр с числовым значением, превышающим 8, – 0, 1, 2. 
5. Выкидываем все комбинации, в которых 0 оказался ведущим, таких будет $1 \times C(4, 1) \times 10^3$ (тут $C(4, 1)$ отвечает за то, что мы выбираем позицию для семерки)
6. Итог: $5 \times (3^3 \times C(4, 3) \times 8^1 + 3^2 \times C(4, 2) \times 8^2 + 3^1 \times C(4, 1) \times 8^3 + 3^0 \times C(4, 0) \times 8^4) - C(4, 1) \times 11^3 = 67476$

```python
from itertools import product

alphabet = '0123456789AB'

result = 0
for comb in product(alphabet, repeat=5):
    if comb.count('7') == 1:
        if comb.count('9') + comb.count('A') + comb.count('B') <= 3:
            if comb[0] != '0':
                result += 1
print(result) # 67476
```

[условие 2](https://education.yandex.ru/ege/task/e327b270-8faa-450f-a350-e313a28bbee9)

Перебирать такое руками достаточно муторно, т.к. мы будем вынуждены рассматривать много случаев. Напишем код:

```python
from itertools import product

alphabet = '0123'

result = 0
for comb in product(alphabet, repeat=4):
    if comb[0] != '0':
        flag = False
        for letter in alphabet:
            if comb.count(letter) >= 2:
                flag = True
        if flag:
            result += 1
print(result)
```


# упорядоченные множества

## простой перебор

[условие](https://education.yandex.ru/ege/task/e4cfd50f-2037-4857-a82c-1bd6d011446a)
```python
from itertools import product

alphabet = 'ЖКМФЦЧ'

answer = 0
for comb in product(alphabet, repeat = 6):
    if comb.count('Ч') >= 2:
        answer += 1
print(answer)
```

## поиск слова по условию

[условие](https://education.yandex.ru/ege/task/e35fe06d-0405-44b7-8976-4bd4bc4aaa7b)

```python
# Б И К Н О П Р
# 0 1 2 3 4 5 6

# последнее слово -> наибольшее число
# буквы не повторяются -> все цифры различны
# 654443_7

from itertools import product

alphabet = 'БИКНОПР'
generator = product(alphabet, repeat=6)
answer = 0
last_comb = None
for i, combination in enumerate(generator):
    if combination.count('О') == 3 and len(set(combination)) == 4:
        answer = i + 1
        last_comb = combination
print(answer, last_comb)

print(int('654443', 7) + 1)
```

## количество слов на промежутке

[условие](https://education.yandex.ru/ege/task/4ea1674f-830a-466f-951a-801a0f77a505)

```python
from itertools import product

alphabet = 'ДЛМОУЬ'
generator = product(alphabet, repeat=6)

first, last = 1000000000000, 0
for i, comb in enumerate(generator):
    if comb[0] == 'М' and (i + 1) % 2 == 1:
        first = min(first, i + 1)
        last = max(last, i + 1)
print(last - first - 1)
```

## перебор слов на промежутке с условиями

[условие](https://education.yandex.ru/ege/task/de7eace6-8794-4d1b-b0fd-c7c42cff77d5)

```python
from itertools import product

alphabet = 'АДКЛО'
lodka_idx = 0
oklad_idx = 0

def comb_to_string(comb):
    result = ''
    for c in comb:
        result += c
    return result

for i, comb in enumerate(product(alphabet, repeat=5)):
    if comb_to_string(comb) == 'ЛОДКА':
        lodka_idx = i
    if comb_to_string(comb) == 'ОКЛАД':
        oklad_idx = i

answer = 0
for i, comb in enumerate(product(alphabet, repeat=5)):
    if lodka_idx < i < oklad_idx:
        if comb[2] == 'Д':
            if comb.count('О') == 2:
                if comb[-2] in ['Д', 'К', 'Л']:
                    answer += 1
print(answer)
```

## перебор со сложными условиями (TODO)

[условие](https://education.yandex.ru/ege/task/cf899119-5ce5-4245-b13a-33214cacb8e9)